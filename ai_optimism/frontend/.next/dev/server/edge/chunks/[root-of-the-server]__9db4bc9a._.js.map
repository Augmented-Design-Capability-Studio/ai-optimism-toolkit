{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/app/api/chat/route.ts"],"sourcesContent":["import { createGoogleGenerativeAI } from '@ai-sdk/google';\nimport { streamText, convertToCoreMessages } from 'ai';\n\nexport const runtime = 'edge';\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json();\n    const { messages, apiKey, provider = 'google', model: modelName = 'gemini-2.0-flash' } = body;\n    \n    console.log('[Chat API] Request received:', { \n      hasApiKey: !!apiKey, \n      provider, \n      model: modelName,\n      messageCount: messages?.length \n    });\n    \n    if (!apiKey) {\n      // Don't log error for initial empty requests (common on page load)\n      if (!messages || messages.length === 0) {\n        console.log('[Chat API] No API key provided (initial load - ignoring)');\n      } else {\n        console.error('[Chat API] No API key provided for', messages.length, 'messages');\n      }\n      return new Response(JSON.stringify({ error: 'API key required. Please configure your AI provider settings.' }), { \n        status: 400,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    // Create Google provider with user-provided API key\n    // Note: We only support Google for now. OpenAI and Anthropic require installing additional packages\n    console.log('[Chat API] Creating Google provider with model:', modelName);\n    const google = createGoogleGenerativeAI({\n      apiKey,\n    });\n    \n    const model = google(modelName || 'gemini-2.0-flash');\n    \n    console.log('[Chat API] Starting stream...');\n    \n    try {\n      // Convert UI messages to core messages format\n      const coreMessages = convertToCoreMessages(messages);\n      console.log('[Chat API] Converted messages:', coreMessages);\n      \n      const result = await streamText({\n        model,\n        messages: coreMessages,\n        system: `You are an expert optimization assistant helping users design optimization problems. \n      \nGuide users through:\n1. Defining variables (what can be changed)\n2. Setting properties (calculated values based on variables)\n3. Defining objectives (what to optimize for)\n4. Adding constraints (limits and requirements)\n\nWhen extracting information, be precise and structured. Ask clarifying questions when needed.`,\n      });\n\n      console.log('[Chat API] Stream created, returning response...');\n      \n      // Return the stream in the UI message format that useChat expects\n      return result.toUIMessageStreamResponse();\n    } catch (streamError) {\n      console.error('[Chat API] Stream error:', streamError);\n      const errorMessage = streamError instanceof Error ? streamError.message : 'Stream error';\n      return new Response(JSON.stringify({ \n        error: 'Failed to start stream', \n        details: errorMessage \n      }), { \n        status: 500,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n  } catch (error) {\n    console.error('[Chat API] Error:', error);\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n    return new Response(JSON.stringify({ \n      error: 'Error processing chat', \n      details: errorMessage \n    }), { \n      status: 500,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  }\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,MAAM,UAAU;AAEhB,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,WAAW,QAAQ,EAAE,OAAO,YAAY,kBAAkB,EAAE,GAAG;QAEzF,QAAQ,GAAG,CAAC,gCAAgC;YAC1C,WAAW,CAAC,CAAC;YACb;YACA,OAAO;YACP,cAAc,UAAU;QAC1B;QAEA,IAAI,CAAC,QAAQ;YACX,mEAAmE;YACnE,IAAI,CAAC,YAAY,SAAS,MAAM,KAAK,GAAG;gBACtC,QAAQ,GAAG,CAAC;YACd,OAAO;gBACL,QAAQ,KAAK,CAAC,sCAAsC,SAAS,MAAM,EAAE;YACvE;YACA,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAgE,IAAI;gBAC9G,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;QAEA,oDAAoD;QACpD,oGAAoG;QACpG,QAAQ,GAAG,CAAC,mDAAmD;QAC/D,MAAM,SAAS,IAAA,6LAAwB,EAAC;YACtC;QACF;QAEA,MAAM,QAAQ,OAAO,aAAa;QAElC,QAAQ,GAAG,CAAC;QAEZ,IAAI;YACF,8CAA8C;YAC9C,MAAM,eAAe,IAAA,uLAAqB,EAAC;YAC3C,QAAQ,GAAG,CAAC,kCAAkC;YAE9C,MAAM,SAAS,MAAM,IAAA,4KAAU,EAAC;gBAC9B;gBACA,UAAU;gBACV,QAAQ,CAAC;;;;;;;;6FAQ4E,CAAC;YACxF;YAEA,QAAQ,GAAG,CAAC;YAEZ,kEAAkE;YAClE,OAAO,OAAO,yBAAyB;QACzC,EAAE,OAAO,aAAa;YACpB,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,MAAM,eAAe,uBAAuB,QAAQ,YAAY,OAAO,GAAG;YAC1E,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBACjC,OAAO;gBACP,SAAS;YACX,IAAI;gBACF,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YACjC,OAAO;YACP,SAAS;QACX,IAAI;YACF,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;AACF"}}]
}